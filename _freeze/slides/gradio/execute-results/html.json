{
  "hash": "bab7a26d4f27f16ae3904db69c51bc60",
  "result": {
    "markdown": "---\ntitle: Build and Host Machine Learning Demos \ntitle-slide-attributes:\n  data-background-image: ../images/logo.png\n  data-background-size: contain\n  data-background-opacity: \"0.5\"\nlang: en\nsubtitle: with HuggingFace and Gradio\nauthor: Jan Kirenz\nexecute:\n  eval: false\n  echo: true\nhighlight-style: github\nformat:\n  revealjs: \n    toc: true\n    toc-depth: 1\n    embed-resources: false\n    theme: [dark, ../custom.scss]  \n    incremental: true\n    transition: slide\n    background-transition: fade\n    transition-speed: slow\n    code-copy: true\n    code-line-numbers: true\n    smaller: false\n    scrollable: true\n    slide-number: c\n    preview-links: auto\n    chalkboard: \n      buttons: false\n   # logo: ../images/logo.png\n    footer: Jan Kirenz\n---\n\n# Build and Host Machine Learning Demos with Gradio ‚ö° & Hugging Face\n\n# Introduction\n\n## Why Demos?\n\n![](../images/gradio-website.png)\n\n\n- Developers can easily **present** their work to a wide audience\n\n- Increase **reproducibility** of machine learning research\n\n- Easily **identify and debug** failure points of models\n\n\n## Learning goals\n\nLearn how to:\n\n:::{.callout-tip}\n1. Build a quick demo for your machine learning model in Python using the `gradio` library\n2. Host the demos for free with Hugging Face Spaces\n3. Add your demo to the Hugging Face org for your class\n:::\n\n\n## Keras Org on Hugging Face\n\n- As a quick example of what we would like to build, check out the [Keras Org on Hugging Face](https://huggingface.co/keras-io)\n\n\n- Open any **Space** in your browser to use the model immediately\n\n\n# Gradio Basics\n\n`gradio` is a Python library that lets you build web demos simply by specifying the list of input and output **components** expected by your machine learning model. \n\n## Gradio components\n\n- Gradio comes with a bunch of predefined components for different kinds of machine learning models. \n\n- For an **image classifier**, the expected input type is an `Image` and the output type is a `Label`.\n\n- For a **speech recognition model**, the expected input component is an `Microphone` (which lets users record from the browser) or `Audio` (which lets users drag-and-drop audio files), while the output type is `Text`. \n\n- For a **question answering model**, we expect **2 inputs**: [`Text`, `Text`], one textbox for the paragraph and one for the question, and the output type is a single `Text` corresponding to the answer. \n\n- For all of the supported components, [see the docs](https://gradio.app/docs/)\n\n## Gradio prediction function\n\n- In addition to the input and output types, Gradio expects a third parameter, which is the prediction function itself. \n\n- This parameter can be ***any* regular Python function** that takes in parameter(s) corresponding to the input component(s) and returns value(s) corresponding to the output component(s)\n\n# Python setup\n\n::: {.cell execution_count=1}\n``` {.python .cell-code}\nfrom IPython.display import IFrame\nimport numpy as np\nimport gradio as gr\n```\n:::\n\n\n# Image App\n\n## Custom Python function\n\n- Let's create a simple Python function\n\n. . .\n\n::: {.cell execution_count=2}\n``` {.python .cell-code}\ndef sepia(image):\n    sepia_filter = np.array(\n        [[0.393, 0.769, 0.189],\n         [0.349, 0.686, 0.168],\n         [0.272, 0.534, 0.131]]\n    )\n    sepia_img = image.dot(sepia_filter.T)\n    sepia_img /= sepia_img.max()\n    return sepia_img\n\n```\n:::\n\n\n## Gradio Image App \n\n::: {.cell execution_count=3}\n``` {.python .cell-code}\ngr.Interface(  # <1>\n    fn=sepia,  # <2>\n    inputs=\"image\",  # <3>\n    outputs=\"image\"  # <4>\n).launch()  # <5>\n```\n:::\n\n\n1. We define an Gradio `Interface` using:\n2. a function `fn`\n3. Input component: `inputs` image\n4. Output component: `outputs` image\n5. ... and `launch` the app\n\n# Gradio Sound App \n\nCreate an app that generates a musical tone when provided a few different parameters.\n\n## Gradio App {.smaller}\n\n::: {.cell execution_count=4}\n``` {.python .cell-code}\ndef generate_tone(note, octave, duration):\n    sampling_rate = 48000\n    a4_freq, tones_from_a4 = 440, 12 * (octave - 4) + (note - 9)\n    frequency = a4_freq * 2 ** (tones_from_a4 / 12)\n    audio = np.linspace(0, int(duration), int(duration) * sampling_rate)\n    audio = (20000 * np.sin(audio * (2 * np.pi * frequency))).astype(np.int16)\n    return sampling_rate, audio\n\n\ngr.Interface(\n    generate_tone,  # function\n    [\n        gr.Dropdown([\"C\", \"C#\", \"D\", \"D#\", \"E\", \"F\", \"F#\",\n                    \"G\", \"G#\", \"A\", \"A#\", \"B\"], type=\"index\"),\n        gr.Slider(4, 6, step=1),\n        gr.Number(value=1, label=\"Duration in seconds\"),\n    ],\n    \"audio\",\n    title=\"Generate a Musical Tone!\"\n).launch()\n```\n:::\n\n\n# Text-to-Speech App\n\nIt is especially easy to demo a `transformers` model from Hugging Face's Model Hub, using the special `gr.Interface.load` method. \n\nText-to-speech model built by Facebook:\n\n::: {.cell execution_count=5}\n``` {.python .cell-code}\ngr.Interface.load(\"huggingface/facebook/fastspeech2-en-ljspeech\").launch()\n```\n:::\n\n\n# GPT-J App\n\nDemo for [GPT-J](https://huggingface.co/EleutherAI/gpt-j-6B), a large language model & add a couple of examples inputs:\n\n::: {.cell execution_count=6}\n``` {.python .cell-code}\nexamples = [[\"A student at HdM Stuttgart is\"],\n            [\"In Stuttgart you can \"]]\n\ngr.Interface.load(\"huggingface/EleutherAI/gpt-j-6B\",\n                  examples=examples).launch()\n```\n:::\n\n\n# Build your own App\n\n- You can go to the [Hugging Face Model Hub](https://huggingface.co/models) and pick any model that performs one of the tasks supported in the `transformers` library\n\n- Create a Gradio demo for that model using `gr.Interface.load`.\n\n# Host the Demo\n\nHost the Demo (for free) on Hugging Face Spaces\n\n## Workflow {.smaller}\n\n- Here are the steps to that (also see GIF in the next slid):\n\nA. First, create a Hugging Face account if you do not already have one, by visiting <https://huggingface.co/> and clicking \"Sign Up\"\n\nB. Once you are logged in, click on your profile picture and then click on \"New Space\" underneath it to get to this page: <https://huggingface.co/new-space>\n\nC. Give your Space a name and a license. Select \"Gradio\" as the Space SDK, and then choose \"Public\" if you are fine with everyone accessing your Space and the underlying code\n\nD. Then you will find a page that provides you instructions on how to upload your files into the Git repository for that Space. You may also need to add a `requirements.txt` file to specify any Python package dependencies.\n\nE. Once you have pushed your files, that's it! Spaces will automatically build your Gradio demo allowing you to share it with anyone, anywhere!\n\n## Workflow in a GIF\n\n![GIF](https://huggingface.co/blog/assets/28_gradio-spaces/spaces-demo-finalized.gif)\n\n\n## Share your demo\n\n- You can embed your Gradio demo on any website -- in a blog, a portfolio page, or even in a colab notebook, \n\n- Example: Pictionary sketch recognition model below:\n\n::: {.cell execution_count=7}\n``` {.python .cell-code}\nIFrame(src='https://hf.space/gradioiframe/abidlabs/Draw/+', width=1000, height=800)\n```\n:::\n\n\n# Add Demo to our Hugging Face organization\n\n## Workflow\n\nA. You find the link to our organization (HdM-...) in [Moodle](https://moodle.hdm-stuttgart.de/login/index.php) \n\nB. Visit the organization page and click \"Request to join this org\" button, if you are not yet part of the org.\n\nC. Then, once you have been approved to join the organization (and built your Gradio Demo and uploaded it to Spaces -- see Sections above): \n  - Go to your Space and go to `Settings > Rename or transfer this space`\n  - select the organization name under `New owner`. \n  - Click the button and the Space will now be added to our organization\n\n\n# Acknowledgments\n\n*The slides are mainly based on a toolkit provided by Abubakar Abid from HuggingFace*\n\n\n# What's next? {background-image=\"../images/logo.png\" background-opacity=\"0.5\"}\n\n**Congratulations! You have completed this tutorial** üëç\n\n**Next, you may want to go back to the [lab's website](https://kirenz.github.io/lab-huggingface/)**\n\n",
    "supporting": [
      "gradio_files"
    ],
    "filters": [],
    "includes": {}
  }
}